

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/Rigel.png">
  <link rel="icon" href="/img/Rigel.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Rigel">
  <meta name="keywords" content="">
  
    <meta name="description" content="Games are inherently event-driven. Events are things that happen during the game and you want to pay attention to, such as explosions, players being seen by enemies, picking up health packs ...">
<meta property="og:type" content="article">
<meta property="og:title" content="Illusion Engine 04 - Event System">
<meta property="og:url" content="https://rigel.github.io/EventSystem/index.html">
<meta property="og:site_name" content="Rigel Blog">
<meta property="og:description" content="Games are inherently event-driven. Events are things that happen during the game and you want to pay attention to, such as explosions, players being seen by enemies, picking up health packs ...">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-05T05:44:23.000Z">
<meta property="article:modified_time" content="2023-04-20T02:56:32.601Z">
<meta property="article:author" content="Rigel">
<meta property="article:tag" content="Original">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Game Development">
<meta property="article:tag" content="Computer Graphics">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Illusion Engine 04 - Event System - Rigel Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"rigel.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"ZgzmD6Hm82vvDfnkCgGAcZhI-gzGzoHsz","app_key":"RPnpqTBjC8oNMLXr2F7RdvB2","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Rigel Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>Links</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/banner2.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Illusion Engine 04 - Event System"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-05 01:44" pubdate>
          August 5, 2022 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          15k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          43 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> times
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Illusion Engine 04 - Event System</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Games are inherently <strong>event-driven</strong>. Events are things that happen during the game and you want to pay attention to, such as explosions, players being seen by enemies, picking up health packs, and so on. Games usually need some way to do two things: notify objects that care about the event when it occurs, and have those objects respond to the event. The design pattern adopted by the event system is <strong>the Observer Pattern</strong>.</p>
<hr>
<h2 id="Principle"><a href="#Principle" class="headerlink" title="Principle"></a>Principle</h2><h3 id="Abstract-Events-into-Classes"><a href="#Abstract-Events-into-Classes" class="headerlink" title="Abstract Events into Classes"></a>Abstract Events into Classes</h3><p>Events usually fall into two parts: <strong>type</strong> and <strong>features</strong>. Type defines the overall information about events and features provide details. Some engine would call such structure as <strong>message</strong> or <strong>command</strong>.</p>
<p>There are several benefits to abstract events into classes:</p>
<ul>
<li>We only need <strong>one event processor function</strong>. All kinds of event could be represented by an instance of a class, so we only need a virual function to handle all of them, such as:</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">OnEvent</span><span class="hljs-params">(Event&amp; event)</span></span>;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>Events <strong>could be stored</strong>: Event objects store their types and parameters when they are created, so they are persistent and can be used for later processing, or to copy and broadcast to multiple receives.</p>
</li>
<li><p>Events could be <strong>easily forwarded</strong>: An object can forward an event to another object without knowing the details of the event.</p>
</li>
</ul>
<h3 id="Event-Processing"><a href="#Event-Processing" class="headerlink" title="Event Processing"></a>Event Processing</h3><ul>
<li><p><strong>Event Dispatcher</strong>: Most game objects only care about a small set of events, and it is very inefficient to multicast events every time. To improve the efficiency of event handling, objects can register the events they care about. For example, we can implement an event dispatcher for an object that accepts <strong>an event type to bind to</strong>. When a specific event is triggered, the dispatcher <strong>compares the incoming event type</strong> with the bound event type and <strong>passes the matching event as a parameter</strong> to the event handler of the object.</p>
</li>
<li><p><strong>Callback Functions</strong>: Somtimes a game object receives an event and needs to respond in some way. This process is called event handling and is usually implemented as a function called an <strong>callback function</strong>. In some high-level languages, callback functions can be registered by storing function pointers (C&#x2F;C++) or delegates (C#) and called when specific events are received.</p>
</li>
<li><p><strong>Event Forwarding</strong>:There are often dependencies between game objects, and events sometimes need to be <strong>passed down</strong> the dependency chain. Usually, the order of event delivery is determined by the developer, and <strong>a Boolean value</strong> is returned by the event handler to indicate whether the object has processed the event and whether to continue forwarding.</p>
</li>
</ul>
<hr>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="Event-Type-x2F-Event-Category"><a href="#Event-Type-x2F-Event-Category" class="headerlink" title="Event Type&#x2F; Event Category"></a>Event Type&#x2F; Event Category</h3><p>Events include key events, mouse events, application events, etc. For key events, there would be states like pressed, released, continous pressed. And for mouse events, there would be pressed, moved, scrolled, and so on. So, we could abstract them into some enums called <strong>EventType</strong> and include them with different categories.</p>
<p>Thus, we need to create a file called <strong>Events.h</strong> in <em><strong>Illusion&#x2F;src&#x2F;Engine&#x2F;Event&#x2F;…</strong></em> folder and enter:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pch.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Engine/Core/Core.h&quot;</span></span><br><br><span class="hljs-comment">//--------------------namespace: Illusion starts--------------------</span><br><span class="hljs-keyword">namespace</span> Illusion<br>&#123;<br>	<span class="hljs-keyword">enum class</span> <span class="hljs-title class_">EventType</span> <br>	&#123;<br>		None = <span class="hljs-number">0</span>,<br>		WindowClose, WindowResize, WindowFocus, WindowLostFocus, WindowMoved,<br>		AppTick, AppUpdate, AppRender,<br>		KeyPressed, KeyReleased, KeyTyped,<br>		MouseButtonPressed, MouseButtonReleased, MouseMoved, MouseScrolled<br>	&#125;;<br><br>	<span class="hljs-keyword">enum</span> <span class="hljs-title class_">EventCategory</span> <br>	&#123;<br>		None = <span class="hljs-number">0</span>,<br>		EventCategoryApplication		= <span class="hljs-built_in">BIT</span>(<span class="hljs-number">0</span>), <span class="hljs-comment">//1</span><br>		EventCategoryInput				= <span class="hljs-built_in">BIT</span>(<span class="hljs-number">1</span>), <span class="hljs-comment">//10</span><br>		EventCategoryKeyboard			= <span class="hljs-built_in">BIT</span>(<span class="hljs-number">2</span>), <span class="hljs-comment">//100</span><br>		EventCategoryMouse				= <span class="hljs-built_in">BIT</span>(<span class="hljs-number">3</span>), <span class="hljs-comment">//1000</span><br>		EventCategoryMouseButton		= <span class="hljs-built_in">BIT</span>(<span class="hljs-number">4</span>)  <span class="hljs-comment">//10000</span><br>	&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>BIT(x)</strong> is a macro defined in <strong>Core.h</strong>, which is used to <em><strong>shift 1 to the left by x bits</strong></em>.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> BIT(x) (1 &lt;&lt; x)</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>The reason why we set EventCategory like this is based on the following requirement: A <strong>single event</strong> could be in <strong>multiple categories</strong>. For example, KeyPressed could be in EventCategoryInput, but it could also be in EventCategoryKeyboard. In case like this, how do we figure out whether an event belongs to a certain event category?</p>
</li>
<li><p>The more direct but complicated way to do this is to maintian a list of categories in each event type. When we need to figure out whether it is in the catergory, we just need to iterate through the list and return true if the categories matched with the desired one.</p>
</li>
<li><p>Here we use the idea of <em><strong>bitfields</strong></em> to implement the solution. Each category is assign a <strong>binary value</strong> instead of decimal numbers like 1,2,3. By doing so, these non-zero bits are like <strong>flags</strong> that represent different categories. We could easily mask out the value we need.</p>
<ul>
<li>Here’s an example: For event type belongs to EventCategoryInput, EventCategoryMouse, and EventCategoryMouseButton at the same time, its category could be represented like EventCategoryMouseButton | EventCategoryMouse | EventCategoryInput which equals to 11010. If we want to figure out whether it belongs to EventCategoryMouse, we could simply use <strong>EventCategoryMouse &amp; EventType’s Category</strong> which would turn into 1000 &amp; 11010 &#x3D;&gt; 01000. In the end, 01000 equals to <strong>true</strong> since <strong>only 00000 equals to false</strong>. So this event belongs to EventCategoryMouse.</li>
</ul>
</li>
</ul>
<h3 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h3><p>The <strong>Event</strong> class is a <em>virtual</em> class. It is used as a template for all events. Create the class in Events.h.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs C++">	<span class="hljs-comment">//Macros used to implement GetStaticType/GetEventType/GetName/GetCategoryFlags in the inherited class</span><br>	<span class="hljs-comment">// # is used to transform type into a string</span><br>	<span class="hljs-comment">// GetStaticType can be used as a static method, could be used without an object</span><br>	<span class="hljs-comment">// GetEventType can be used as a property method, can only be used with an instance/object</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> EVENT_CLASS_TYPE(type) static EventType GetStaticType() &#123; return EventType::type; &#125;\</span><br><span class="hljs-meta">								virtual EventType GetEventType() const override &#123; return GetStaticType(); &#125;\</span><br><span class="hljs-meta">								virtual const char* GetName() const override &#123; return #type; &#125;</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> EVENT_CLASS_CATEGORY(category) virtual int GetCategoryFlags() const override &#123; return category; &#125;</span><br><span class="hljs-comment">// Abstract event class</span><br><span class="hljs-comment">// All kinds of events inherates from event</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span><br>&#123;<br>	<span class="hljs-comment">// Make the Dispatcher to be a friend class</span><br>	<span class="hljs-comment">// Authorize the Dispatcher to edit m_Handled</span><br>	<span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EventDispatcher</span>;<br><span class="hljs-keyword">public</span>:<br>	<span class="hljs-comment">// = 0 means pure virtual/ it has to be implemented elsewhere in inherited class</span><br>	<span class="hljs-comment">// const means the function would not change the property of the class</span><br>	<span class="hljs-function"><span class="hljs-keyword">virtual</span> EventType <span class="hljs-title">GetEventType</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-title">GetName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">int</span> <span class="hljs-title">GetCategoryFlags</span><span class="hljs-params">()</span><span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;<br>	<span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">GetName</span>(); &#125;<br>	<span class="hljs-comment">// Check whether the input is in certain category</span><br>	<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">bool</span> <span class="hljs-title">IsInCategory</span><span class="hljs-params">(EventCategory category)</span></span><br><span class="hljs-function">	</span>&#123;<br>		<span class="hljs-comment">// GetCategoryFlags returns flags Such as 10000/01000/00001</span><br>		<span class="hljs-comment">// category usually used as EventCategoryMouseButton | EventCategoryMouse | EventCategoryInput</span><br>		<span class="hljs-comment">// the code is equivelent to (example):</span><br>		<span class="hljs-comment">// return 10000 &amp; 11010, which is 10000</span><br>		<span class="hljs-comment">// For bool, if there&#x27;s at least on bit not 0, the return would be true.</span><br>		<span class="hljs-keyword">return</span> <span class="hljs-built_in">GetCategoryFlags</span>() &amp; category;<br>	&#125;<br>	<span class="hljs-comment">// Check whether the event still have to be handled</span><br>	<span class="hljs-type">bool</span> m_Handled = <span class="hljs-literal">false</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>There are two macros defined here: <strong>EVENT_CLASS_TYPE(type)</strong> and <strong>EVENT_CLASS_CATEGORY(catergory)</strong>. By using them, event classed inherited from Event such as KeyEvent, MouseEvent, can easily complete the necessary <strong>function implementation at once</strong>.</p>
</li>
<li><p>For an input event, it is necessary to store an bool called <strong>EventHandled</strong>, which is used to detect whether the current event still can be responded to, since we don’t want everything to have the same priority. For example, when clicking on the UI, we don’t want to shoot a bullet suddenly. In short, events <strong>need to be consumed</strong>, and the consumed events will not be responded to by other logic.</p>
</li>
</ul>
<h3 id="Event-Dispatcher"><a href="#Event-Dispatcher" class="headerlink" title="Event Dispatcher"></a>Event Dispatcher</h3><p>To register the events that objects care about, we need to implement an <strong>event dispatcher</strong>. Basically, it <strong>binds an event with a callback function</strong>. When the event it listens to is triggered, the dispacter would call the corresponding callback function. Event dispatcher corresponds to a function one by one, and this function returns a bool to decide whether to forward this event.</p>
<p>In <strong>Events.h</strong>, create a class called <strong>EventDispatcher</strong>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-comment">// Class Event Dispatcher</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EventDispatcher</span><br>&#123;<br>	<span class="hljs-comment">// Define EventFn() Template</span><br>	<span class="hljs-comment">// Input: T&amp;</span><br>	<span class="hljs-comment">// Output: bool</span><br>	<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;<br>	<span class="hljs-comment">// Set EventFn as another name for std::function&lt;bool(T&amp;)&gt;</span><br>	<span class="hljs-keyword">using</span> EventFn = std::function&lt;<span class="hljs-built_in">bool</span>(T&amp;)&gt;;<br><span class="hljs-keyword">public</span>:<br>	<span class="hljs-comment">// Bind the event to the dispatcher</span><br>	<span class="hljs-comment">// Each dispatcher could only bind with one kind of event</span><br>	<span class="hljs-built_in">EventDispatcher</span>(Event&amp; event)<br>		: <span class="hljs-built_in">m_Event</span>(event) &#123;&#125;<br>	<span class="hljs-comment">// Make a template funtion to dipatche the event</span><br>	<span class="hljs-comment">// Input: a function</span><br>	<span class="hljs-comment">// Output: bool</span><br>	<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="hljs-function">	<span class="hljs-type">bool</span> <span class="hljs-title">Dispatch</span><span class="hljs-params">(EventFn&lt;T&gt; func)</span></span><br><span class="hljs-function">	</span>&#123;<br>		<span class="hljs-comment">// Compare the bound event with the input event associated with the function</span><br>		<span class="hljs-comment">// GetStaticType is implemented in class inherited from Event, in this context it is T</span><br>		<span class="hljs-keyword">if</span> (m_Event.<span class="hljs-built_in">GetEventType</span>() == T::<span class="hljs-built_in">GetStaticType</span>())<br>		&#123;<br>			<span class="hljs-comment">// Call the input function with *(T*)&amp;m_Event, which means:</span><br>			<span class="hljs-comment">// &amp;m_Event		= the address of the event bound to the dipatcher</span><br>			<span class="hljs-comment">// (T*)			= the cast to the pointer towards the type T</span><br>			<span class="hljs-comment">// *			= dereference the pointer</span><br>			<span class="hljs-comment">// The output of the function determins wheter to consume the event or not</span><br>			m_Event.m_Handled = <span class="hljs-built_in">func</span>(*(T*)&amp;m_Event);<br>			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>		&#125;<br>		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>	&#125;<br><span class="hljs-keyword">private</span>:<br>	Event&amp; m_Event;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>The most tricky and important part is the function called <strong>Dispatch</strong>. This function <strong>receive a function</strong> as its parameter and for the Event T, it compares T’s type and the type that dispatcher bound to. If events’ types matched, it would <strong>call the function</strong> it received.</p>
</li>
<li><p><strong>func(*(T*)&amp;m_Event)</strong> seems really scary, but its principle is simple: we <strong>take the address</strong> of m_Event, cast it into a <strong>pointer</strong> of T, and then <strong>dereference</strong> it. And because func() is actually std::function&lt;bool(T&amp;)&gt;, the actual parameter is a *<strong>reference of an Event</strong>.</p>
</li>
</ul>
<h3 id="KeyEvent"><a href="#KeyEvent" class="headerlink" title="KeyEvent"></a>KeyEvent</h3><p><strong>KeyEvent</strong> class inherits from Event class. Create <strong>KeyEvent.h</strong> in <em><strong>Illusion&#x2F;src&#x2F;Engine&#x2F;Events&#x2F;…</strong></em> folder.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Events.h&quot;</span></span><br><br> <span class="hljs-comment">//--------------------namespace: Illusion starts--------------------</span><br><span class="hljs-keyword">namespace</span> Illusion<br>&#123;<br>	<span class="hljs-comment">// KeyEvent</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">GetKeyCode</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_KeyCode; &#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryKeyboard | EventCategoryInput)<br><br>	<span class="hljs-keyword">protected</span>:<br>		<span class="hljs-comment">// Bind it with a certain key</span><br>		<span class="hljs-built_in">KeyEvent</span>(<span class="hljs-type">int</span> keycode)<br>			: <span class="hljs-built_in">m_KeyCode</span>(keycode) &#123;&#125;<br><br>		<span class="hljs-type">int</span> m_KeyCode;<br>	&#125;;<br><br>	<span class="hljs-comment">// Keypressed Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyPressedEvent</span> : <span class="hljs-keyword">public</span> KeyEvent<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">KeyPressedEvent</span>(<span class="hljs-type">int</span> keycode, <span class="hljs-type">int</span> repeatCount)<br>			:<span class="hljs-built_in">KeyEvent</span>(keycode), <span class="hljs-built_in">m_RepeatCount</span>(repeatCount) &#123;&#125;<br><br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">GetRepeatCount</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_RepeatCount; &#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;KeyPressedEvent: &quot;</span> &lt;&lt; m_KeyCode &lt;&lt; <span class="hljs-string">&quot; (&quot;</span> &lt;&lt; m_RepeatCount &lt;&lt; <span class="hljs-string">&quot; repeats)&quot;</span>;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(KeyPressed)<br><br>	<span class="hljs-keyword">private</span>:<br>		<span class="hljs-type">int</span> m_RepeatCount;<br>	&#125;;<br><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyReleasedEvent</span> : <span class="hljs-keyword">public</span> KeyEvent<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">KeyReleasedEvent</span>(<span class="hljs-type">int</span> keycode)<br>			: <span class="hljs-built_in">KeyEvent</span>(keycode) &#123;&#125;<br><br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;KeyReleasedEvent: &quot;</span> &lt;&lt; m_KeyCode;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(KeyReleased)<br>	&#125;;<br><br><br>	<span class="hljs-comment">// Keytyped Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyTypedEvent</span> : <span class="hljs-keyword">public</span> KeyEvent<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">KeyTypedEvent</span>(<span class="hljs-type">int</span> keycode)<br>			:<span class="hljs-built_in">KeyEvent</span>(keycode) &#123;&#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;KeyTypedEvent: &quot;</span> &lt;&lt; m_KeyCode;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(KeyTyped)<br><br>	&#125;;<br>	<span class="hljs-comment">//--------------------namespace: Illusion ends--------------------</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p><strong>ToString()</strong> is used to support the log system.</p>
</li>
<li><p><strong>RepeatCount</strong> is used to distinguish whether the user has pressed the button once or kept pressing the button.</p>
</li>
</ul>
<h3 id="MouseEvent"><a href="#MouseEvent" class="headerlink" title="MouseEvent"></a>MouseEvent</h3><p><strong>MouseEvent</strong> class inherits from Event class. Create <strong>MouseEvent.h</strong> in <em><strong>Illusion&#x2F;src&#x2F;Engine&#x2F;Events&#x2F;…</strong></em> folder.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Events.h&quot;</span></span><br><br> <span class="hljs-comment">//--------------------namespace: Illusion starts--------------------</span><br><span class="hljs-keyword">namespace</span> Illusion<br>&#123;<br>	<span class="hljs-comment">// Mouse Moved Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseMovedEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">MouseMovedEvent</span>(<span class="hljs-type">float</span> x, <span class="hljs-type">float</span> y)<br>			: <span class="hljs-built_in">m_MouseX</span>(x), <span class="hljs-built_in">m_MouseY</span>(y) &#123;&#125;<br><br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title">GetX</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_MouseX; &#125;<br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title">GetY</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_MouseY; &#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;MouseMovedEvent: &quot;</span> &lt;&lt; m_MouseX &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; m_MouseY;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(MouseMoved)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryMouse | EventCategoryInput)<br><br>	<span class="hljs-keyword">private</span>:<br>		<span class="hljs-type">float</span> m_MouseX, m_MouseY;<br>	&#125;;<br><br>	<span class="hljs-comment">// Mouse Scolled Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseScrolledEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">MouseScrolledEvent</span>(<span class="hljs-type">float</span> xOffset, <span class="hljs-type">float</span> yOffset)<br>			: <span class="hljs-built_in">m_XOffset</span>(xOffset), <span class="hljs-built_in">m_YOffset</span>(yOffset) &#123;&#125;<br><br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title">GetXOffset</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_XOffset; &#125;<br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">float</span> <span class="hljs-title">GetYOffset</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_YOffset; &#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;MouseScrolledEvent: &quot;</span> &lt;&lt; <span class="hljs-built_in">GetXOffset</span>() &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; <span class="hljs-built_in">GetYOffset</span>();<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(MouseScrolled)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryMouse | EventCategoryInput)<br><br>	<span class="hljs-keyword">private</span>:<br>		<span class="hljs-type">float</span> m_XOffset, m_YOffset;<br>	&#125;;<br><br><br>	<span class="hljs-comment">// Mouse Button Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseButtonEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">GetMouseButton</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_Button; &#125;<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryMouse | EventCategoryInput)<br><br>	<span class="hljs-keyword">protected</span>:<br>		<span class="hljs-built_in">MouseButtonEvent</span>(<span class="hljs-type">int</span> button)<br>			: <span class="hljs-built_in">m_Button</span>(button) &#123;&#125;<br><br>		<span class="hljs-type">int</span> m_Button;<br>	&#125;;<br><br>	<span class="hljs-comment">// Mouse Button Pressed Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseButtonPressedEvent</span> : <span class="hljs-keyword">public</span> MouseButtonEvent<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">MouseButtonPressedEvent</span>(<span class="hljs-type">int</span> button)<br>			: <span class="hljs-built_in">MouseButtonEvent</span>(button) &#123;&#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;MouseButtonPressedEvent: &quot;</span> &lt;&lt; m_Button;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(MouseButtonPressed)<br>	&#125;;<br><br>	<span class="hljs-comment">// Mouse Button Released Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">MouseButtonReleasedEvent</span> : <span class="hljs-keyword">public</span> MouseButtonEvent<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">MouseButtonReleasedEvent</span>(<span class="hljs-type">int</span> button)<br>			: <span class="hljs-built_in">MouseButtonEvent</span>(button) &#123;&#125;<br><br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;MouseButtonReleasedEvent: &quot;</span> &lt;&lt; m_Button;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(MouseButtonReleased)<br>	&#125;;<br><br>	<span class="hljs-comment">//--------------------namespace: Illusion ends--------------------</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="AppEvent"><a href="#AppEvent" class="headerlink" title="AppEvent"></a>AppEvent</h3><p><strong>AppEvent</strong> class inherits from Event class. It is used to handle the <strong>events that are related to windows</strong>. Create <strong>AppEvent.h</strong> in <em><strong>Illusion&#x2F;src&#x2F;Engine&#x2F;Events&#x2F;…</strong></em> folder.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">pragma</span> once</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Events.h&quot;</span></span><br><br> <span class="hljs-comment">//--------------------namespace: Illusion starts--------------------</span><br><span class="hljs-keyword">namespace</span> Illusion<br>&#123;<br>	<span class="hljs-comment">// Window Resize Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowResizeEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">WindowResizeEvent</span>(<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> width, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> height)<br>			: <span class="hljs-built_in">m_Width</span>(width), <span class="hljs-built_in">m_Height</span>(height) &#123;&#125;<br><br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title">GetWidth</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_Width; &#125;<br>		<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> <span class="hljs-title">GetHeight</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>&#123; <span class="hljs-keyword">return</span> m_Height; &#125;<br>		<br>		<span class="hljs-function">std::string <span class="hljs-title">ToString</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span></span><br><span class="hljs-function">		</span>&#123;<br>			std::stringstream ss;<br>			ss &lt;&lt; <span class="hljs-string">&quot;WindowResizeEvent: &quot;</span> &lt;&lt; m_Width &lt;&lt; <span class="hljs-string">&quot;, &quot;</span> &lt;&lt; m_Height;<br>			<span class="hljs-keyword">return</span> ss.<span class="hljs-built_in">str</span>();<br>		&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(WindowResize)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryApplication)<br>	<span class="hljs-keyword">private</span>:<br>		<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> m_Width, m_Height;<br>	&#125;;<br><br>	<span class="hljs-comment">// Window Close Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">WindowCloseEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">WindowCloseEvent</span>() &#123;&#125;<br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(WindowClose)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryApplication)<br>	&#125;;<br><br>	<span class="hljs-comment">// App Tick Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppTickEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">AppTickEvent</span>() &#123;&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryApplication)<br>	&#125;;<br><br>	<span class="hljs-comment">// App Update Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppUpdateEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">AppUpdateEvent</span>() &#123;&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(AppUpdate)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryApplication)<br>	&#125;;<br><br>	<span class="hljs-comment">// App Render Event</span><br>	<span class="hljs-keyword">class</span> <span class="hljs-title class_">AppRenderEvent</span> : <span class="hljs-keyword">public</span> Event<br>	&#123;<br>	<span class="hljs-keyword">public</span>:<br>		<span class="hljs-built_in">AppRenderEvent</span>() &#123;&#125;<br><br>		<span class="hljs-built_in">EVENT_CLASS_TYPE</span>(AppRender)<br>		<span class="hljs-built_in">EVENT_CLASS_CATEGORY</span>(EventCategoryApplication)<br>	&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>So far, we have completed a simple event system. In order to use it, we could add some code in <strong>Application.cpp</strong>:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;pch.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Application.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Engine/Core/Log/Log.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Engine/Events/Events.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;Engine/Events/AppEvent.h&quot;</span></span><br><br><span class="hljs-keyword">namespace</span> Illusion <br>&#123;<br>	<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Application::Run</span><span class="hljs-params">()</span> </span><br><span class="hljs-function">    </span>&#123;<br>		<span class="hljs-function">WindowResizeEvent <span class="hljs-title">e</span><span class="hljs-params">(<span class="hljs-number">1280</span>,<span class="hljs-number">720</span>)</span></span>;<br>		<span class="hljs-built_in">ENGINE_CORE_TRACE</span>(e);<br>		<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Original/">#Original</a>
      
        <a href="/tags/C/">#C++</a>
      
        <a href="/tags/Game-Development/">#Game Development</a>
      
        <a href="/tags/Computer-Graphics/">#Computer Graphics</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Illusion Engine 04 - Event System</div>
      <div>https://rigel.github.io/EventSystem/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Rigel</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>August 5, 2022</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }

        Fluid.events.registerRefreshCallback(function() {
          if ('MathJax' in window && MathJax.startup.document && typeof MathJax.startup.document.state === 'function') {
            MathJax.startup.document.state(0);
            MathJax.texReset();
            MathJax.typeset();
            MathJax.typesetPromise();
          }
        });
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.2/es5/tex-mml-chtml.js" ></script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>




  
<script src="/js/particle.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
